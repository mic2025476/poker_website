{% extends 'core/base.html' %}
{% load static i18n %}

{% block content %}
<style>
  :root {
    --poker-bg: #020617;
    --poker-card: #0b1220;
    --poker-card-soft: rgba(15,23,42,0.95);
    --poker-accent: var(--theme-red);
    --poker-accent-soft: rgba(220,20,60,0.18);
    --poker-gold: #fbbf24;
    --poker-border: rgba(148, 163, 184, 0.5);
    --poker-text-soft: #e5e7eb;
  }

  #contact-section {
    position: relative;
    min-height: 100vh;
    color: var(--poker-text-soft);
    display: flex;
    align-items: center;
    padding: 6rem 0 4rem;
    overflow: hidden;
  }

  /* Themed background using your poker table / theme image */
  #contact-section::before {
    content: "";
    position: absolute;
    inset: 0;
    background:
      radial-gradient(circle at top, rgba(15,23,42,0.65), rgba(15,23,42,0.95)),
      url("{% static 'mge_pictures/thumbs/DSC_0009.JPG' %}") center center / cover no-repeat fixed;
    opacity: 1;
    z-index: -2;
  }

  /* Soft vignette overlay to match rest of theme */
  #contact-section::after {
    content: "";
    position: absolute;
    inset: 0;
    background:
      radial-gradient(circle at top, rgba(220,20,60,0.27), transparent 55%),
      radial-gradient(circle at bottom, rgba(15,23,42,0.8), rgba(0,0,0,0.9));
    mix-blend-mode: screen;
    opacity: 0.9;
    z-index: -1;
  }

  .contact-wrapper {
    max-width: 1080px;
    margin: 0 auto;
  }

  .contact-heading {
    text-transform: uppercase;
    letter-spacing: 0.16em;
    font-size: 0.8rem;
    color: var(--poker-gold);
    opacity: 0.9;
  }

  .contact-title {
    font-weight: 800;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    font-size: clamp(1.9rem, 2.7vw, 2.4rem);
  }

  .contact-subtitle {
    color: #9ca3af;
    font-size: 0.95rem;
    max-width: 520px;
  }

  .contact-card {
    border-radius: 1.25rem;
    background:
      linear-gradient(135deg, rgba(15,23,42,0.96), rgba(15,23,42,0.98)),
      radial-gradient(circle at top left, rgba(220,20,60,0.18), transparent 60%);
    border: 1px solid rgba(148, 163, 184, 0.45);
    box-shadow:
      0 22px 55px rgba(0, 0, 0, 0.85),
      0 0 0 1px rgba(15,23,42,0.9);
    padding: 1.8rem 1.7rem 1.9rem;
    backdrop-filter: blur(10px);
  }

  .contact-card::before {
    content: "♠";
    position: absolute;
    top: 14px;
    right: 18px;
    font-size: 2.6rem;
    color: var(--poker-accent);
    opacity: 0.12;
    pointer-events: none;
  }

  .contact-label {
    font-size: 0.78rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.14em;
    color: #9ca3af;
  }

  .form-control.contact-input,
  .form-control.contact-message {
    background: rgba(15,23,42,0.92);
    border-radius: 0.75rem;
    border: 1px solid var(--poker-border);
    color: #f9fafb;
    font-size: 0.9rem;
  }

  .form-control.contact-input:focus,
  .form-control.contact-message:focus {
    border-color: var(--poker-accent);
    box-shadow: 0 0 0 1px var(--poker-accent-soft);
    background: rgba(15,23,42,0.98);
    color: #f9fafb;
  }

  .form-control::placeholder {
    color: #6b7280;
  }

  .contact-message {
    min-height: 140px;
    resize: vertical;
  }

  .contact-meta {
    font-size: 0.8rem;
    color: #9ca3af;
  }

  .contact-meta i {
    color: var(--poker-accent);
  }

  .contact-pill {
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
    padding: 0.38rem 0.9rem;
    border-radius: 999px;
    border: 1px solid rgba(148, 163, 184, 0.5);
    background: radial-gradient(circle at top, rgba(15,23,42,0.95), rgba(15,23,42,0.9));
    font-size: 0.75rem;
    color: #e5e7eb;
    box-shadow: 0 10px 25px rgba(0,0,0,0.7);
  }

  .contact-pill-dot {
    width: 8px;
    height: 8px;
    border-radius: 999px;
    background: var(--poker-accent);
    box-shadow: 0 0 0 3px rgba(220,20,60,0.35);
  }

  .contact-details {
    font-size: 0.9rem;
    color: #d1d5db;
  }

  .contact-details a {
    color: inherit;
    text-decoration: none;
  }

  .contact-details a:hover {
    color: var(--poker-gold);
  }

  #contactAlert {
    border-radius: 0.7rem;
    font-size: 0.85rem;
  }

  .btn-contact-submit {
    border-radius: 999px;
    font-weight: 600;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    font-size: 0.8rem;
    padding: 0.72rem 1.4rem;
    border: none;
    background: linear-gradient(135deg, var(--poker-accent), var(--theme-red));
    color: #f9fafb;
    box-shadow:
      0 12px 30px rgba(220,20,60,0.55),
      0 0 0 1px rgba(248,250,252,0.08);
  }

  .btn-contact-submit:hover {
    background: linear-gradient(135deg, var(--theme-red), var(--poker-accent));
    color: #ffffff;
    transform: translateY(-1px);
  }

  .btn-contact-submit:active {
    transform: translateY(0);
    box-shadow: 0 5px 16px rgba(0,0,0,0.8);
  }

  .btn-contact-submit:disabled {
    opacity: 0.7;
    box-shadow: none;
  }

  @media (max-width: 767.98px) {
    #contact-section {
      padding-top: 5.5rem;
      padding-bottom: 3rem;
    }

    .contact-card {
      padding: 1.4rem 1.25rem 1.6rem;
    }
  }

  @media (min-width: 1200px) {
    .contact-message {
      min-height: 170px;
    }
  }
</style>

<section id="contact-section">
  <div class="container contact-wrapper">
    <div class="row g-4 align-items-start">
      <div class="col-12 col-lg-5 mb-3 mb-lg-0">
        <div class="mb-3">
          <div class="contact-heading mb-2">
            {% trans "Get in Touch" %}
          </div>
          <h1 class="contact-title mb-2">
            {% trans "Contact Us" %}
          </h1>
          <p class="contact-subtitle">
            {% trans "Have a question about bookings, private events or tournaments? Send us a message and our team will get back to you as soon as possible." %}
          </p>
        </div>

        <div class="d-flex flex-column gap-2 contact-details">
          <div class="contact-pill mb-2">
            <span class="contact-pill-dot"></span>
            <span>{% trans "Typical reply time:" %} {% trans "within 24 hours" %}</span>
          </div>

        </div>
      </div>

      <div class="col-12 col-lg-7 position-relative">
        <!-- Success/Error Message -->
        <div id="contactAlert" class="alert d-none mb-3" role="alert"></div>

        <!-- Contact Form Card -->
        <div class="position-relative contact-card">
          <form id="contactForm">
            <div class="mb-3">
              <label for="contactName" class="contact-label mb-1">
                {% trans "Name" %}
              </label>
              <input type="text" class="form-control contact-input" id="contactName"
                     name="name" required
                     placeholder="{% trans 'Your full name' %}">
            </div>

            <div class="mb-3">
              <label for="contactEmail" class="contact-label mb-1">
                {% trans "Email address" %}
              </label>
              <input type="email" class="form-control contact-input" id="contactEmail"
                     name="email" required
                     placeholder="you@example.com">
            </div>

            <div class="mb-3">
              <label for="contactMessage" class="contact-label mb-1">
                {% trans "Message" %}
              </label>
              <textarea class="form-control contact-message" id="contactMessage"
                        name="message" required
                        placeholder="{% trans 'Tell us how we can help you…' %}"></textarea>
            </div>

            <div class="d-flex justify-content-between align-items-center mb-3">
              <div class="contact-meta">
                <i class="fas fa-lock me-1"></i>
                {% trans "Your details are only used to reply to your request." %}
              </div>
            </div>

            <button type="submit"
                    class="btn custom-red-button w-100"
                    id="submitBtn">
            {% trans "Send Message" %}
            </button>

          </form>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  const contactScriptUrl = "https://script.google.com/macros/s/AKfycbzjgFhr_1tSuMUTWMutUCpyOYWUcWpOGpY-GO-t_nz75S-13QQt0Wpd3xrFZMeae7OcJw/exec";

  document.getElementById('contactForm').addEventListener('submit', async function(e) {
    e.preventDefault();

    const submitBtn = document.getElementById('submitBtn');
    const alertBox = document.getElementById('contactAlert');
    const form = e.target;

    const name = document.getElementById('contactName').value.trim();
    const email = document.getElementById('contactEmail').value.trim();
    const message = document.getElementById('contactMessage').value.trim();

    if (!name || !email || !message) {
      alertBox.className = 'alert alert-danger mb-3';
      alertBox.textContent = '{% trans "Please fill in all fields." %}';
      alertBox.classList.remove('d-none');
      return;
    }

    submitBtn.disabled = true;
    submitBtn.innerHTML =
      '<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>{% trans "Sending..." %}';

    // Build URL for Apps Script: mode=contact
    const url = contactScriptUrl
      + '?mode=contact'
      + '&name=' + encodeURIComponent(name)
      + '&email=' + encodeURIComponent(email)
      + '&message=' + encodeURIComponent(message);

    try {
      const response = await fetch(url);
      const data = await response.json();

      if (data.success) {
        alertBox.className = 'alert alert-success mb-3';
        alertBox.textContent =
          data.message || '{% trans "Thank you! Your message has been sent." %}';
        alertBox.classList.remove('d-none');
        form.reset();
      } else {
        alertBox.className = 'alert alert-danger mb-3';
        alertBox.textContent =
          data.message || '{% trans "Failed to send message. Please try again." %}';
        alertBox.classList.remove('d-none');
      }
    } catch (err) {
      console.error('Contact form error:', err);
      alertBox.className = 'alert alert-danger mb-3';
      alertBox.textContent =
        '{% trans "Network error. Please check your connection and try again." %}';
      alertBox.classList.remove('d-none');
    } finally {
      submitBtn.disabled = false;
      submitBtn.innerHTML = '{% trans "Send Message" %}';
      setTimeout(() => alertBox.classList.add('d-none'), 6000);
    }
  });
</script>

{% endblock %}
